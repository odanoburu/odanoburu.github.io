<!DOCTYPE html>
<html lang="pt">
<head>
<!-- 2025-01-27 -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Como provar que você sabia algo numa data passada</title>
<meta name="description" content="Se você tem conhecimento de uma fraude que ainda vai se concretizar, como provar esse conhecimento post factum sem alertar os fraudadores?" />
<meta name="keywords" content="technical crypto" />
<meta name="generator" content="Org Mode" />
<link rel="stylesheet" href="/static/site.css"/><link rel="icon" type="image/x-icon" href="/static/favicon.ico"/><script src="/static/site.js" defer=""></script>
<script>
  window.MathJax = {
    tex: {
      ams: {
        multlineWidth: '85%'
      },
      tags: 'ams',
      tagSide: 'right',
      tagIndent: '.8em'
    },
    chtml: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    svg: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    output: {
      font: 'mathjax-modern',
      displayOverflow: 'overflow'
    }
  };
</script>

<script
  id="MathJax-script"
  async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>
</head>
<body>
<header id="top" class="status">
<div class="nav">
  <ul id="navlinks" class="horizontal-list">
    <li>
      <a href="/">Home</a>
    </li>
    <li>
      <a href="/blog/index.html">Blog</a>
    </li>
    <li>
      <a href="/about.html">About</a>
    </li>
  </ul>
</div>
</header>
<main id="content" class="content">
<header>
<h1 class="title">Como provar que você sabia algo numa data passada</h1>
</header><p>
Digamos que você descobriu um esquema de manipulação dos resultados da
mega-sena, descobrindo inclusive o nome do próximo ganhador. Se você
for à imprensa denunciar, os fraudadores simplesmente escolherão outro
ganhador, você ficará descreditado, e a fraude será continuará
posteriormente. Como você poderia provar que sabia da fraude antes
dela ocorrer, sem anunciar seu conhecimento publicamente e portanto
evitando coibir que ela acontecesse?
</p>

<p>
Essa situação pode parecer improvável, mas <a href="https://www1.folha.uol.com.br/poder/2017/04/1878315-folha-antecipou-resultado-de-licitacao-de-publicidade-do-banco-do-brasil.shtml">a Folha já antecipou o
resultado de mais de uma licitação pública</a>. Como a Folha provou que
sabia o resultado das licitações antes deles serem publicados?
Registrando em cartório os resultados dias antes da publicação.
</p>

<p>
Neste post, mostraremos como provar conhecimento de alguma informação
sem o uso de cartórios. Além de custoso, o uso de um intermediário
como um cartório demanda confiança nesse intermediário. Temos de
confiar que o cartório não irá informar pessoas que se beneficiariam
da informação registrada (no caso da Folha, o órgão licitante), que a
informação registrada está segura, e que o público em geral confia nas
informações registradas no cartório (confiando por exemplo que o
cartório não recebeu dinheiro extra da Folha para mentir sobre o
registro antecipado).
</p>

<p>
Para provar conhecimento de uma informação em uma data qualquer Y,
precisamos apenas de uma forma de publicação que possa ser verificada
como tendo sido feita na data Y. No caso da Folha, o próprio jornal
poderia ser esse meio. Para provar o conhecimento de uma informação na
data Y, publicamos o <a href="https://en.wikipedia.org/wiki/Cryptographic_hash_function">hash criptográfico</a> de um texto contendo essa
informação na data Y. Pelas propriedades matemáticas de um hash
criptográfico — das quais falaremos mais adiante — é para todos os
fins impossível de descobrir qual texto que originou um determinado
hash [1], bem como é fácil de verificar se um certo texto originou um
determinado hash ou não (precisamos apenas de saber apenas o algoritmo
de hash utilizado, e o texto em questão) [2]. Também importante para
impedir <a href="https://dicionario.priberam.org/contrafa%C3%A7%C3%A3o">contrafações</a>, é para todos os fins impossível criar um segundo
texto diferente que origine o mesmo hash [3].
</p>

<p>
No caso da Folha, o procedimento seria o seguinte: o jornal escreveria
um texto antecipando o resultado da licitação. O texto alimentaria uma
função hash criptográfica, que produziria um hash, a ser publicado no
jornal na data Y; o texto original é mantido em segredo enquanto isso.
Na data Y + n, um dia depois da publicação oficial do resultado da
licitação, a Folha publica o texto que originou o hash publicado na
data Y, afirmando essa correspondência, que pode então ser facilmente
verificada por qualquer assinante (via propriedade [2]).
</p>

<p>
Pela propriedade [1] discutida acima, sabe-se que é impossível que as
pessoas afetadas negativamente pela informação da Folha descubram que
o jornal possuía essa informação apenas pela publicação do hash, pois
o hash nada mais é do que um número, e é impossível recuperar o texto
original deste número sem saber o texto de antemão.
</p>

<p>
Pela propriedade [2] discutida acima, é possível verificar que o texto
de fato produz o hash publicado na data Y (basta dá-lo como entrada da
função de hash usada).
</p>

<p>
Finalmente, pela propriedade [3], é impossível que a Folha tenha
falsificado o hash, isto é, que o jornal não conhecesse de fato o
resultado da licitação antes da sua publicação, que ele tenha
publicado um hash arbitrário e depois — na data Y + n — escolhido um
texto apropriado contendo o nome do vencedor revelado no dia anterior.
</p>

<section id="outline-container-org6d987c8" class="outline-2">
<h2 id="org6d987c8">O que é uma função hash?</h2>
<div class="outline-text-2" id="text-org6d987c8">
<p>
Uma função hash é uma função de uma sequência de bits de tamanho
arbitrário (que pode codificar um número, um texto, uma imagem, etc.)
para uma sequência de bits de tamanho fixo \(k\) (a depender do
algoritmo utilizado). Como se trata de uma função de um conjunto
infinito para um conjunto finito (de \(2^k\)), teremos necessariamente
colisões (duas entradas mapeadas para o mesmo hash). Se \(k\) for
suficientemente grande, no entanto, \(2^k\) elementos é um número bem
grande, e encontrar duas entradas tais que ambas tenham o mesmo hash
demanda muito tempo computacional, a ponto de serem inviáveis —
assumindo que a função hash criptográfica escolhida é bem-desenhada.
Assim, garantimos a propriedade [3].
</p>


<figure id="org128694a">
<img src="../static/hash-examples.svg" alt="hash-examples.svg" class="org-svg">

<figcaption><span class="figure-number">Figure 1: </span>Exemplo de aplicações de uma função hash criptográfica</figcaption>
</figure>

<p>
Muitas linguagens de programação possuem implementações de funções
hash criptográficas. Em Python, podemos fazer
</p>
<div class="org-src-container">
<pre class="src src-python">&gt;&gt;&gt; <span style="font-weight: bold;">from</span> hashlib <span style="font-weight: bold;">import</span> sha256
&gt;&gt;&gt; sha256(<span style="font-style: italic;">"O resultado da licita&#231;&#227;o 95845/2024 ser&#225; a empresa XYZ&#8230;"</span>.encode(<span style="font-style: italic;">'utf-8'</span>)).hexdigest()
<span style="font-style: italic;">'8509c84b5a007cec46f7bfa61e1a2dd9dabbbe31a0354c93d12ec83313f76040'</span>
</pre>
</div>
<p>
para obter um hash de um texto usando o algoritmo <a href="https://en.wikipedia.org/wiki/SHA-2">SHA-2</a>. Qualquer
outra implementação do mesmo algoritmo dará o mesmo resultado para a
mesma entrada, permitindo a verificação garantida pela propriedade
[2].
</p>

<p>
Pelo fato do universo de entradas possíveis da função hash ser
infinito, é impossível descobrir qual entrada origina um determinado
hash — assumindo que a entrada não seja previsível. Se a entrada usada
no caso de revelação antecipada do resultado de uma licitação tiver
sempre o mesmo formato, bastaria substituir o nome de todos os
participantes de uma licitação no formato estabelecido para descobrir
todos os hashes possíveis, e portanto determinar o texto original. Se
a entrada for imprevisível, garantimos a propriedade [1].
</p>
</div>
</section>

<section id="outline-container-org7825815" class="outline-2">
<h2 id="org7825815">Posso confiar que uma função hash criptográfica é segura sem entender como ela produz seus resultados?</h2>
<div class="outline-text-2" id="text-org7825815">
<p>
Nem toda função hash criptográfica é considerada segura atualmente —
algumas tiveram vulnerabilidades (bugs no desenho da função)
descobertas, o que significa que elas não possuem algumas das
propriedades elencadas acima. Já outras funções não tem as mesmas
vulnerabilidades descobertas, e são consideradas seguras. A função
<a href="https://en.wikipedia.org/wiki/SHA-2">SHA-2</a> mencionada acima é usada no <a href="uma-introdução-ao-protocolo-bitcoin-em-português.html">protocolo Bitcoin</a>.
</p>

<p>
O uso da função SHA-2 no protocolo Bitcoin nos permite fazer um
argumento econômico quanto a sua segurança. A descoberta de uma
vulnerabilidade grave no algoritmo SHA-2 permitiria a manipulação da
rede Bitcoin, gerando bilhões de dólares de lucro para os
descobridores (se eles escolherem usar essa informação para fins
ilegais), ou milhões de dólares em ganhos de reputação e contratos de
consultoria (se eles escolherem o caminho ético/legal). Dados os
valores em jogo, diversas pessoas e organizações tentaram — e ao que
tudo indica falharam — em encontrar tais vulnerabilidades, apontando
para a segurança do algoritmo.
</p>
</div>
</section>

<section id="outline-container-org6128261" class="outline-2">
<h2 id="org6128261">É prático usar o esquema descrito neste post ao invés de um intermediário como um cartório?</h2>
<div class="outline-text-2" id="text-org6128261">
<p>
Depende do público que quisermos convencer. Se o público em questão é
educado o suficiente para compreender os conceitos envolvidos, ou
acreditaria no testemunho de especialistas de segurança (ou no <a href="https://csrc.nist.gov/projects/hash-functions">NIST</a>
americano), ou se convenceria pelo argumento econômico baseado no
protocolo Bitcoin, sim. Caso contrário, os cartórios podem ser uma
solução mais simples de intermediário, se o público acreditar que eles
são confiáveis.
</p>

<p>
PS: Este post descreve um <a href="https://en.wikipedia.org/wiki/Commitment_scheme">“esquema de compromisso”</a> simples.
</p>
</div>
</section>
</main>
</body>
</html>
